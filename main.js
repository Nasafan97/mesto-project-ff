(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{K:()=>k,G:()=>P});var e="8dbe2058-c3e9-43bd-bec4-3024a54b8cad",n="https://nomoreparties.co/v1/wff-cohort-32";function r(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function o(){return fetch("".concat(n,"/users/me"),{method:"GET",headers:{authorization:e}}).then(r)}function c(t){t.classList.add("popup_is-animated"),t.classList.add("popup_is-opened"),document.addEventListener("keydown",i),t.addEventListener("click",u)}function a(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function i(t){"Escape"===t.key&&a(document.querySelector(".popup_is-opened"))}function u(t){(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&a(t.currentTarget)}var l=document.querySelector("#card-template").content;function s(t,o,i,u,s){var d=l.querySelector(".places__item").cloneNode(!0),p=d.querySelector(".card__image"),f=d.querySelector(".card__title"),m=d.querySelector(".card__like-count"),_=d.querySelector(".card__delete-button");return p.src=t.link,p.alt=t.name,f.textContent=t.name,s!==t.owner._id&&_.classList.add("card__delete-button-hidden"),d.addEventListener("click",(function(l){var s;l.target.classList.contains("card__like-button")?(o(l),l.target.classList.contains("card__like-button_is-active")?(s=t._id,fetch("".concat(n,"/cards/likes/").concat(s),{method:"PUT",headers:{authorization:e}}).then(r)).then((function(t){0!==t.likes.length&&m.classList.remove("card__like-count-inactive"),m.textContent=t.likes.length})).catch((function(t){return console.error("Ошибка вывода количества лайков карточки:",t)})):function(t){return fetch("".concat(n,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:e}}).then(r)}(t._id).then((function(t){0===t.likes.length?m.classList.add("card__like-count-inactive"):m.textContent=t.likes.length})).catch((function(t){return console.error("Ошибка вывода количества лайков карточки:",t)}))):l.target.classList.contains("card__image")?i(p,f):l.target.classList.contains("card__delete-button")&&(c(k),k.addEventListener("click",(function(){u(d,t._id),a(k)}),{once:!0}))})),d}function d(t,o){t.remove(),function(t){return fetch("".concat(n,"/cards/").concat(t),{method:"DELETE",headers:{authorization:e}}).then(r)}(o).catch((function(t){return console.error("Ошибка удаления карточки:",t)}))}function p(t){t.target.classList.toggle("card__like-button_is-active")}function f(t,e){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(P.inputErrorClass),n.classList.remove(P.errorClass),n.textContent=""}function m(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(P.inactiveButtonClass)):(e.disabled=!0,e.classList.add(P.inactiveButtonClass))}function _(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));n.forEach((function(e){f(t,e)})),m(n,t.querySelector(e.submitButtonSelector))}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var y,h=document.querySelector(".places__list"),b=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__image"),L=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_new-card"),E=document.forms["edit-profile"],k=document.querySelector(".popup_type_delete-card"),q=document.querySelector(".popup_type_edit-avatar"),x=document.forms["new-place"],A=document.forms.avatar,T=E.elements.name,j=E.elements.description,w=A.elements["avatar-link"],O=document.querySelector(".profile__title"),z=document.querySelector(".profile__description"),P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function D(t,e){var n=document.querySelector(".popup_type_image"),r=n.querySelector(".popup__image"),o=n.querySelector(".popup__caption");r.src=t.src,r.alt=t.alt,o.textContent=e.textContent,c(n)}function B(t,e){e.querySelector(".popup__button").textContent=t?"Сохранение...":"Сохранить"}Promise.all([o(),fetch("".concat(n,"/cards"),{method:"GET",headers:{authorization:e}}).then(r)]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return v(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0];r[1].forEach((function(t){h.append(s(t,p,D,d,o._id))}))})).catch((function(t){return console.error("Ошибка получения карточек с сервера:",t)})),b.addEventListener("click",(function(){T.value=O.textContent,j.value=z.textContent,_(L,P),c(L)})),S.addEventListener("click",(function(){x.reset(),_(C,P),c(C)})),g.addEventListener("click",(function(){A.reset(),_(q,P),c(q)})),q.addEventListener("submit",(function(t){var o;t.preventDefault(),B(!0,q),(o=w.value,fetch("".concat(n,"/users/me/avatar"),{method:"PATCH",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({avatar:o})}).then(r)).then((function(t){g.style.backgroundImage="url(".concat(t.avatar,")")})).catch((function(t){return console.error("Ошибка обновления аватарки:",t)})).finally((function(){B(!1,q),a(q)}))})),E.addEventListener("submit",(function(t){var o,c;t.preventDefault(),B(!0,L),O.textContent=T.value,z.textContent=j.value,(o=O.textContent,c=z.textContent,fetch("".concat(n,"/users/me"),{method:"PATCH",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({name:o,about:c})}).then(r)).catch((function(t){return console.error("Ошибка обновления профиля:",t)})).finally((function(){B(!1,L),a(L)}))})),document.addEventListener("DOMContentLoaded",(function(){o().then((function(t){O.textContent=t.name,z.textContent=t.about,g.style.backgroundImage="url(".concat(t.avatar,")")})).catch((function(t){return console.error("Ошибка загрузки профиля:",t)}))})),x.addEventListener("submit",(function(t){var o,c;t.preventDefault(),B(!0,C),(o=x.elements["place-name"].value,c=x.elements.link.value,fetch("".concat(n,"/cards"),{method:"POST",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({name:o,link:c})}).then(r)).then((function(t){h.prepend(s(t,p,D,d,t.owner._id))})).catch((function(t){return console.error("Ошибка создания новой карточки:",t)})).finally((function(){B(!1,C),a(C)}))})),y=P,Array.from(document.querySelectorAll(y.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault})),function(t){var e=Array.from(t.querySelectorAll(P.inputSelector)),n=t.querySelector(P.submitButtonSelector);e.forEach((function(r){r.addEventListener("input",(function(){(function(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?f(t,e):function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(P.inputErrorClass),r.textContent=n,r.classList.add(P.errorClass)}(t,e,e.validationMessage)})(t,r),m(e,n)}))}))}(t)}))})();